!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports,require("react"),require("kefir"),require("infestines")):"function"==typeof define&&define.amd?define(["exports","react","kefir","infestines"],r):r(e.karet=e.karet||{},e.React,e.Kefir,e.I)}(this,function(e,r,n,t){"use strict";function i(e,r){e.at=0,e.doSubscribe(r),e.at=1}function a(e,r,n){if(P(e))return n[r.at++];if(t.isArray(e)){for(var i=e,s=0,l=e.length;s<l;++s){var o=e[s],u=o;P(o)?u=n[r.at++]:t.isArray(o)&&(u=a(o,r,n)),u!==o&&(i===e&&(i=e.slice(0)),i[s]=u)}return i}return e}function s(e,r,n){var t=void 0;for(var i in e){var a=e[i];if(P(a)){if(!t){t={};for(var s in e){if(s===i)break;t[s]=e[s]}}t[i]=n[r.at++]}else t&&(t[i]=a)}return t||e}function l(e,r){var n=e.props,t=null,i=null,l=null;e.at=0;for(var o in n){var u=n[o];U===o?l=a(u,e,r):"$$type"===o?t=n[o]:$===o?(i=i||{},i.ref=P(u)?r[e.at++]:u):P(u)?(i=i||{},i[o]=r[e.at++]):g===o?(i=i||{},i.style=s(u,e,r)||u):(i=i||{},i[o]=u)}return l instanceof Array?W.apply(null,[t,i].concat(l)):l?W(t,i,l):W(t,i)}function o(e,r,n){for(var i=0,a=e.length;i<a;++i){var s=e[i];P(s)?n(r,s):t.isArray(s)&&o(s,r,n)}}function u(e,r,n){for(var i in e){var a=e[i];if(P(a))n(r,a);else if(U===i)t.isArray(a)&&o(a,r,n);else if(g===i)for(var s in a){var l=a[s];P(l)&&n(r,l)}}}function f(e){e.values+=1}function c(e,r){r.offAny(e)}function v(e,r){var n=e.pop();n&&r.offAny(n)}function h(e,r){r.onAny(e)}function d(e,r){var n=function r(n){for(var t=e.handlers,i=0;t[i]!==r;)++i;switch(n.type){case k:var a=n.value,s=e.values;s[i]!==a&&(s[i]=a,e.at&&e.forceUpdate());break;case A:throw n.value;default:t[i]=null;var l=t.length;if(l!==e.values.length)return;for(var o=0;o<l;++o)if(t[o])return;e.handlers=null}};e.handlers.push(n),r.onAny(n)}function p(e,r){for(var n=r.length;e<n;++e){var i=r[e];if(P(i)||t.isArray(i)&&p(0,i))return!0}return!1}function y(e){for(var r in e){var n=e[r];if(P(n))return!0;if(U===r){if(t.isArray(n)&&p(0,n))return!0}else if(g===r)for(var i in n)if(P(n[i]))return!0}return!1}function b(e,r){var n={$$type:e};for(var t in r){var i=r[t];"ref"===t?n[$]=i:w!==t&&(n[t]=i)}return n}function m(){for(var e=arguments.length,r=Array(e),n=0;n<e;n++)r[n]=arguments[n];var i=r[0],a=r[1]||t.object0;return(t.isString(i)||a[w])&&(p(2,r)||y(a)?(r[1]=b(i,a),r[0]=E):a[w]&&(r[1]=t.dissocPartialU(w,a)||t.object0)),W.apply(void 0,r)}var k="value",A="error",g="style",U="children",w="karet-lift",$="$$ref",W=r.createElement,j=r.Component,P=function(e){return e instanceof n.Observable},S=t.inherit(function(e){j.call(this,e),this.at=0},j,{componentWillReceiveProps:function(e){this.componentWillUnmount(),i(this,e)},componentWillMount:function(){i(this,this.props)}}),q=t.inherit(function(e){S.call(this,e),this.callback=this.rendered=null},S,{componentWillUnmount:function(){var e=this.callback;e&&this.props.observable.offAny(e)},doSubscribe:function(e){var r=this,n=e.observable;if(P(n)){var t=function(e){switch(e.type){case k:r.rendered=e.value||null,r.at&&r.forceUpdate();break;case A:throw e.value;case"end":r.callback=null}};this.callback=t,n.onAny(t)}else this.rendered=n||null;this.at=1},render:function(){return this.rendered}}),x=function(e){return W(q,{observable:e})},E=t.inherit(function(e){S.call(this,e),this.values=this,this.handlers=null},S,{componentWillUnmount:function(){var e=this.handlers;e instanceof Function?u(this.props,e,c):e&&u(this.props,e.reverse(),v)},doSubscribe:function(e){var r=this;this.values=0,u(e,this,f);var n=this.values;switch(n){case 0:this.values=t.array0;break;case 1:this.values=this,u(e,this.handlers=function(e){switch(e.type){case k:var n=e.value;r.values!==n&&(r.values=n,r.at&&r.forceUpdate());break;case A:throw e.value;default:r.values=[r.values],r.handlers=null}},h);break;default:this.values=Array(n).fill(this),this.handlers=[],u(e,this,d)}},render:function(){if(this.handlers instanceof Function){var e=this.values;return e===this?null:l(this,[e])}for(var r=this.values,n=0,t=r.length;n<t;++n)if(r[n]===this)return null;return l(this,r)}}),C=t.assocPartialU("createElement",m,r),F=function(e){return function(r){return W(E,b(e,r))}};e.fromKefir=x,e.createElement=m,e.default=C,e.fromClass=F,Object.defineProperty(e,"__esModule",{value:!0})});
