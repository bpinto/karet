!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports,require("react"),require("kefir"),require("infestines")):"function"==typeof define&&define.amd?define(["exports","react","kefir","infestines"],r):r(e.karet=e.karet||{},e.React,e.kefir,e.I)}(this,function(e,r,n,t){"use strict";function i(e,r,n){for(var i in e){var a=e[i];if($(a))n(r,a);else if(m===i){if(t.isArray(a))for(var s=0,l=a.length;s<l;++s){var f=a[s];$(f)&&n(r,f)}}else if(k===i)for(var o in a){var u=a[o];$(u)&&n(r,u)}}}function a(e,r){var n=null,i=null,a=null,s=-1;for(var l in e){var f=e[l];if(m===l)if($(f))a=r[++s];else if(t.isArray(f)){for(var o=0,u=f.length;o<u;++o){var c=f[o];if($(c)){if(!a){a=Array(u);for(var v=0;v<o;++v)a[v]=f[v]}a[o]=r[++s]}else a&&(a[o]=c)}a||(a=f)}else a=f;else if("$$type"===l)n=e[l];else if(g===l)i=i||{},i.ref=$(f)?r[++s]:f;else if($(f))i=i||{},i[l]=r[++s];else if(k===l){var h=void 0;for(var d in f){var p=f[d];if($(p)){if(!h){h={};for(var b in f){if(b===d)break;h[b]=f[b]}}h[d]=r[++s]}else h&&(h[d]=p)}i=i||{},i.style=h||f}else i=i||{},i[l]=f}return a instanceof Array?U.apply(null,[n,i].concat(a)):a?U(n,i,a):U(n,i)}function s(e){e.values+=1}function l(e,r){r.offAny(e)}function f(e,r){var n=e.pop();n&&r.offAny(n)}function o(e,r){r.onAny(e)}function u(e,r){var n=function r(n){for(var t=e.handlers,i=0;t[i]!==r;)++i;switch(n.type){case b:var a=n.value,s=e.values;s[i]!==a&&(s[i]=a,e.forceUpdate());break;case y:throw n.value;default:t[i]=null;var l=t.length;if(l!==e.values.length)return;for(var f=0;f<l;++f)if(t[f])return;e.handlers=null}};e.handlers.push(n),r.onAny(n)}function c(e){for(var r in e){var n=e[r];if($(n))return!0;if(m===r){if(t.isArray(n))for(var i=0,a=n.length;i<a;++i)if($(n[i]))return!0}else if(k===r)for(var s in n)if($(n[s]))return!0}return!1}function v(e){for(var r=2,n=e.length;r<n;++r){var i=e[r];if(t.isArray(i)){for(var a=0,s=i.length;a<s;++a)if($(i[a]))return!0}else if($(i))return!0}return c(e[1])}function h(e,r){var n={$$type:e};for(var t in r){var i=r[t];"ref"===t?n[g]=i:A!==t&&(n[t]=i)}return n}function d(e){return e&&!0===e[A]}function p(){for(var e=arguments.length,r=Array(e),n=0;n<e;n++)r[n]=arguments[n];var i=r[0],a=r[1];return(t.isString(i)||d(a))&&(v(r)?(r[1]=h(i,a),r[0]=j):d(a)&&(r[1]=t.dissocPartialU(A,a)||t.object0)),U.apply(void 0,r)}var b="value",y="error",k="style",m="children",A="karet-lift",g="$$ref",U=r.createElement,w=r.Component,$=function(e){return e instanceof n.Observable},S=t.inherit(function(e){w.call(this,e)},w,{componentWillReceiveProps:function(e){this.componentWillUnmount(),this.doSubscribe(e)},componentWillMount:function(){this.doSubscribe(this.props)}}),W=t.inherit(function(e){S.call(this,e),this.callback=this.rendered=null},S,{componentWillUnmount:function(){var e=this.callback;e&&this.props.observable.offAny(e)},doSubscribe:function(e){var r=this,n=e.observable;if($(n)){var t=function(e){switch(e.type){case b:r.rendered=e.value||null,r.forceUpdate();break;case y:throw e.value;case"end":r.callback=null}};this.callback=t,n.onAny(t)}else this.rendered=n||null},render:function(){return this.rendered}}),P=function(e){return U(W,{observable:e})},j=t.inherit(function(e){S.call(this,e),this.values=this,this.handlers=null},S,{componentWillUnmount:function(){var e=this.handlers;e instanceof Function?i(this.props,e,l):e&&i(this.props,e.reverse(),f)},doSubscribe:function(e){var r=this;this.values=0,i(e,this,s);var n=this.values;switch(n){case 0:this.values=t.array0;break;case 1:this.values=this;var a=function(e){switch(e.type){case b:var n=e.value;r.values!==n&&(r.values=n,r.forceUpdate());break;case y:throw e.value;default:r.values=[r.values],r.handlers=null}};this.handlers=a,i(e,a,o);break;default:this.values=Array(n).fill(this),this.handlers=[],i(e,this,u)}},render:function(){if(this.handlers instanceof Function){var e=this.values;return e===this?null:a(this.props,[e])}for(var r=this.values,n=0,t=r.length;n<t;++n)if(r[n]===this)return null;return a(this.props,r)}}),q=t.assocPartialU("createElement",p,r),x=function(e){return function(r){return U(j,h(e,r))}};e.fromKefir=P,e.default=q,e.fromClass=x,Object.defineProperty(e,"__esModule",{value:!0})});
